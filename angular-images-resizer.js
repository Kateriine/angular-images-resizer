!function(){"use strict";angular.module("images-resizer",[])}(),function(e,r){"use strict";r.module("images-resizer").service("resizeService",["$q","$document","$window",function(e,i,t){var a,n=this,s=!(!i[0].createElement("canvas").getContext||!i[0].createElement("canvas").getContext("2d"));this.createImage=function(r,i){var a=e.defer(),n=new t.Image;return i&&(n.crossOrigin=i),n.onload=function(){a.resolve(n)},n.onabort=function(){a.reject("image creation was aborted")},n.onerror=function(e){a.reject(e)},n.src=r,a.promise},this.resizeCanvas=function(e,r,t){if(!r||!t)return e;var a=i[0].createElement("canvas");a.width=r,a.height=t;var n=a.getContext("2d");return n.drawImage(e,0,0,a.width,a.height),a},this.cropCanvas=function(e,r,t,a,n){if(!r||!t)return e;a=a?a:r,n=n?n:t;var s=a<r?(a-r)/2:0,o=n<t?(n-t)/2:0,h=i[0].createElement("canvas");h.width=a,h.height=n;var c=h.getContext("2d");return c.drawImage(e,0,0,r,t,s,o,r,t),h},this.resizeImage=function(i,t){if(!s)return e.reject("Canvas is not supported on your browser");if(!t||!i)return e.reject("Missing argument when calling resizeImage function");var a=e.defer(),o=i.substr(i.length-3);return t={height:t.height?t.height:t.width?null:t.size?null:1024,width:t.width?t.width:t.height?null:t.size?null:1024,size:t.size?t.size:500,sizeScale:t.sizeScale?t.sizeScale:"ko",step:t.step?t.step:3,crop:!!t.crop&&t.crop,outputFormat:"png"===o?"image/png":"image/jpeg",crossOrigin:t.crossOrigin?t.crossOrigin:null},n.createImage(i,t.crossOrigin).then(function(e){if(t.height||t.width)a.resolve(n.resizeImageWidthHeight(e,t.width,t.height,t.step,t.outputFormat,t.crop));else if(t.size){if(r.isString(t.sizeScale))switch(t.sizeScale.toLowerCase()){case"ko":t.size*=1024;break;case"mo":t.size*=1048576;break;case"go":t.size*=1073741824}a.resolve(n.resizeImageBySize(e,t.size,t.outputFormat))}else a.reject("Missing option to resize the image")})["catch"](a.reject),a.promise},this.resizeImageWidthHeight=function(e,r,t,n,s,o){if(!e)return null;s||(s="image/jpeg");var h=r,c=t;if(a=i[0].createElement("canvas"),o){var g=e.width/e.height,l=r/t;g>l?r=t/e.height*e.width:t=r/e.width*e.height}else r||t?!r&&t?r=t/e.height*e.width:r&&!t&&(t=r/e.width*e.height):(r=e.width,t=e.height);var u=e.width!==r&&n?(e.width-r)/n:0,d=e.height!==t&&n?(e.height-t)/n:0;a.width=e.width,a.height=e.height,a.getContext("2d").drawImage(e,0,0,a.width,a.height,0,0,a.width,a.height);var E=0;for(E=1;E<n;E++){var R=e.width-u*E,w=e.height-d*E;a=this.resizeCanvas(a,R,w)}return a=this.resizeCanvas(a,r,t),o&&(a=this.cropCanvas(a,r,t,h,c)),a.toDataURL(s)},this.resizeImageBySize=function(e,r,t){if(!e)return null;t||(t="image/jpeg"),a=i[0].createElement("canvas"),a.width=e.width,a.height=e.height,a.getContext("2d").drawImage(e,0,0,a.width,a.height);for(var s=a.toDataURL(t),o=s,h=n.calulateImageSize(s,t),c=Math.max(1,Math.min(h/r,200)),g=20;h>r&&0!==g;){g--;var l={width:a.width/c,height:a.height/c},u=this.resizeCanvas(a,l.width,l.height);s=u.toDataURL(t);var d=n.calulateImageSize(s,t);d/r<.5||0===d?(c/=2,c<1&&(g=0)):(a=u,o=s,h=d),a=u}return o},this.calulateImageSize=function(e,r){switch(r){case"image/png":r="image/png";break;default:r="image/jpg"}return Math.max(0,Math.round(3*(e.length-("data:"+r+";base64,").length)/4))}}])}(window,window.angular),function(e,r){"use strict";r.module("images-resizer").service("readLocalPicService",["$q","$window",function(e,r){function i(e){var r=null;switch(e.target.error.code){case FileError.NOT_FOUND_ERR:r="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:r="SECURITY_ERR";break;case FileError.ABORT_ERR:r="ABORT_ERR";break;case FileError.NOT_READABLE_ERR:r="NOT_READABLE_ERR";break;case FileError.ENCODING_ERR:r="ENCODING_ERR";break;case FileError.NO_MODIFICATION_ALLOWED_ERR:r="NO_MODIFICATION_ALLOWED_ERR";break;case FileError.INVALID_STATE_ERR:r="INVALID_STATE_ERR";break;case FileError.SYNTAX_ERR:r="SYNTAX_ERR";break;case FileError.INVALID_MODIFICATION_ERR:r="INVALID_MODIFICATION_ERR";break;case FileError.QUOTA_EXCEEDED_ERR:r="QUOTA_EXCEEDED_ERR";break;case FileError.TYPE_MISMATCH_ERR:r="TYPE_MISMATCH_ERR";break;case FileError.PATH_EXISTS_ERR:r="PATH_EXISTS_ERR";break;default:r="Unknown Error: "+e.target.error.code}return r}this.readFileInput=function(t){var a=e.defer();if(t.files&&t.files[0]){r.File&&r.FileReader&&r.FileList&&r.Blob||a.reject("Your browser do not support reading file");var n=new r.FileReader;n.onload=function(e){a.resolve(e.target.result)},n.onabort=function(e){a.reject("Fail to convert file in base64img, aborded: "+i(e))},n.onerror=function(e){a.reject("Fail to convert file in base64img, error: "+i(e))},n.readAsDataURL(t.files[0])}else a.reject("No file selected");return a.promise}}])}(window,window.angular);